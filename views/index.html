<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>{{ title }}</title>

    <link href="../stylesheets/style.css" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="../css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../theme.css" rel="stylesheet">

    <!-- font awesome -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body role="document">

<div class="main_area container" role="main">
    <section>
        <h1>{{ title }}</h1>
        <h3 class="inlinePad" id="outfitT1"></h3><h3 id="V" class="inlinePad"> V </h3><h3 class="inlinePad" id="outfitT2"></h3>
        <p id="T1Score"></p>
        <p id="T2Score"></p>
        <table class="inline">
            <thead><tr><th class="pad">Team One: </th><th class="pad">Score: </th><th class="pad">Net Score: </th><th class="pad">Kills: </th><th class="pad">Deaths: </th></tr></thead>
            <tbody id="Team1">
            <tr id="T1">
            </tr>
            </tbody>
        </table>
        <table class="inline">
            <thead><tr><th class="pad">Team Two: </th><th class="pad">Score: </th><th class="pad">Net Score: </th><th class="pad">Kills: </th><th class="pad">Deaths: </th></tr></thead>
            <tbody id="Team2">
            <tr id="T2">
            </tr>
            </tbody>
        </table>
    </section>
    <section>
        <p>Killfeed: </p>
        <table class="table index-table">
            <thead><tr><th>Winner</th><th>Loser</th><th>Weapon</th><th>Image</th><th>Points</th></tr></thead>
            <tbody id="killfeed"></tbody>
        </table>
    </section>
</div>

<script src="../js/jquery-1.11.1.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/smoothness/jquery-ui.css" />
<script src="../js/jquery-ui.min.js"></script>

<script src="../js/bootstrap.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>

    var socket = io();
    socket.on('connect', function() {
        socket.on('teams', function (data) {
            var event = data.obj;
            console.log(event);
            $('#outfitT1').html('[' + event.teamOne.alias + '] ' + event.teamOne.name);
            $('#outfitT2').html('[' + event.teamTwo.alias + '] ' + event.teamTwo.name);
        });
        socket.on('refresh', function () {
            window.location.reload();
        });
        socket.on('killfeed', function (data) {
            var event = data.obj;
            console.log(event);
            $('<tr><td class="faction' + event.winner_faction + '">' + event.winner + '</td>' +
                    '<td class="faction' + event.loser_faction + '">' + event.loser + '</td>' +
                    '<td>' + event.weapon + '</td>' +
                    '<td>' + event.image + '</td>' +
                    '<td>' + event.points + '</td></tr>')
                    .appendTo($(killfeed));
        });
        socket.on('score', function (data) {
            var event = data.obj;
            console.log(event);
            $('#Team1').empty();
            $('#Team2').empty();
            $('<tr id="T1"><td class="pad">' + event.teamOne.alias + '</td>' +
                    '<td class="pad">' + event.teamOne.points + '</td>' +
                    '<td class="pad">' + event.teamOne.netScore + '</td>' +
                    '<td class="pad">' + event.teamOne.kills + '</td>' +
                    '<td class="pad">' + event.teamOne.deaths + '</td></tr>').appendTo($(Team1));
            $('<tr id="T2"><td class="pad">' + event.teamTwo.alias + '</trtd>' +
                    '<td class="pad">' + event.teamTwo.points + '</td>' +
                    '<td class="pad">' + event.teamTwo.netScore + '</td>' +
                    '<td class="pad">' + event.teamTwo.kills + '</td>' +
                    '<td class="pad">' + event.teamTwo.deaths + '</td></tr>').appendTo($(Team2));
            event.teamOne.members.forEach(function (member) {
                if (member.kills > 0 || member.deaths > 0) {
                    $('<tr id="' + member.name +
                            '"><td class="pad" id="name">' + member.name +
                            '</td><td class="pad" id="score">' + member.points +
                            '</td><td class="pad" id="netScore">' + member.netScore +
                            '</td><td class="pad" id="kills">' + member.kills +
                            '<td class="pad" id="deaths">' + member.deaths +
                            '</td></tr>').appendTo($(Team1));
                }
            });
            event.teamTwo.members.forEach(function (member) {
                if (member.kills > 0 || member.deaths > 0) {
                    $('<tr id="' + member.name +
                            '"><td class="pad" class="pad" id="name">' + member.name +
                            '</td><td class="pad" id="score">' + member.points +
                            '</td><td class="pad" id="netScore">' + member.netScore +
                            '</td><td class="pad" id="kills">' + member.kills +
                            '<td class="pad" id="deaths">' + member.deaths +
                            '</td></tr>').appendTo($(Team2));
                }
            });
        });
    });
    socket.emit('backchat', { obj: 'Web Connection' });

</script>
</body>
</html>